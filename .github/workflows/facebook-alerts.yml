name: Facebook Alerts

on:
  workflow_dispatch: # Allows manual triggers

jobs:
  run-facebook-alerts:
    runs-on: ubuntu-latest
    steps:
      # Step 1: Check out the code
      - name: Checkout code
        uses: actions/checkout@v3

      # Step 2: Ensure the data directory exists
      - name: Prepare Data Directory
        run: mkdir -p data

      # Step 3: Download previously saved data as artifacts (optional)
      - name: Download Artifacts
        uses: actions/download-artifact@v4
        with:
          name: data-files
          path: data
        continue-on-error: true # Ensures workflow continues if no artifacts exist

      # Step 4: Set up Node.js environment
      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 16.18.1

      # Step 5: Install dependencies
      - name: Install dependencies
        run: npm install

      # Step 6: Run the Facebook Alerts script
      - name: Run Facebook Alerts
        env:
          AUTH_KEY: ${{ secrets.AUTH_KEY }}
          PAGE_ID: ${{ secrets.PAGE_ID }}
          ACCESS_TOKEN: ${{ secrets.ACCESS_TOKEN }}
          LOWER_LATITUDE: ${{ secrets.LOWER_LATITUDE }}
          LOWER_LONGITUDE: ${{ secrets.LOWER_LONGITUDE }}
          UPPER_LATITUDE: ${{ secrets.UPPER_LATITUDE }}
          UPPER_LONGITUDE: ${{ secrets.UPPER_LONGITUDE }}
          FULL_RESPONSE: ${{ secrets.FULL_RESPONSE }}
          LIMIT: ${{ secrets.LIMIT }}
        run: node guardianNYC.js

      # Step 7: Upload updated data back as artifacts
      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: data-files
          path: data
